# 機能仕様

## 1. スタートリスト（メイン機能）

メインのタスク管理機能。指定時刻のn分前にアラームで通知。

### 基本仕様

| 項目 | 内容 |
|------|------|
| 概要 | 時刻指定でアラームが鳴るTODOリスト |
| アラーム | 設定時刻のn分前に通知 |
| 自動削除 | アラームが鳴ってから**24時間後**に自動削除 |

### タスクの種類

| 種類 | 説明 | デフォルト |
|------|------|----------|
| 1回きり (`ONE_TIME`) | その日だけのタスク | ✅ デフォルト |
| 週ループ (`WEEKLY_LOOP`) | 指定曜日・時刻で毎週繰り返し | オフ |

### 完了状態の管理

| 項目 | 内容 |
|------|------|
| 管理単位 | **日付ごと** |
| データ構造 | `completedDates: Set<LocalDate>` |
| 週ループでの挙動 | 各曜日ごとに独立した完了状態を持つ |
| 1回きりでの挙動 | 作成日に完了マークを付けると完了 |
| リセット | `resetCompletion(date)` で特定日付のみ解除可能 |

### 週ループ設定

| 項目 | 内容 |
|------|------|
| 曜日選択 | **複数選択可**（例: 月・水・金、平日だけ、毎日） |
| 最低要件 | **1つ以上の曜日が必須** |
| スキップ機能 | 今週だけ休止などが**可能** |

### スキップ機能詳細

| 項目 | 内容 |
|------|------|
| 対象 | 週ループタスクのみ |
| 設定 | `skip(until: LocalDate)` で指定日まで非表示 |
| 判定 | `today <= skipUntil` の場合スキップ中 |
| 解除 | 自動（期限日経過後）または `cancelSkip()` で手動解除 |
| 管理画面 | タスク管理画面からスキップ解除可能 |

### アラーム設定（n分前）

| 設定 | 内容 |
|------|------|
| デフォルト値 | **10分前** |
| 有効範囲 | **0〜60分** |
| デフォルト変更 | 設定画面でグローバル変更可能 |
| 個別変更 | タスクごとに個別設定可能 |

### 入力項目

| 項目 | 必須/任意 | バリデーション | 備考 |
|------|----------|---------------|------|
| タイトル | 必須 | 1文字以上100文字以下 | 空白不可 |
| 時刻 | 必須 | `LocalTime` 形式 | アラーム時刻 (TimePicker UI) |
| n分前 | 任意 | 0〜60分 | デフォルト10分 |
| タスク種類 | 任意 | `ONE_TIME` / `WEEKLY_LOOP` | デフォルト `ONE_TIME` |
| 曜日 | 週ループ時のみ必須 | 1つ以上選択 | 複数選択可 |

### タスク操作

| 操作 | UseCase | 説明 |
|------|---------|------|
| 作成 | `CreateTaskUseCase` | 新規タスク作成 |
| 編集 | `UpdateTaskUseCase` | 既存タスク更新 |
| 削除 | `DeleteTaskUseCase` | タスク削除 |
| 完了マーク | `CompleteTaskUseCase` | 日付ごとの完了状態を設定 |
| スキップ | `SkipTaskUseCase` | 週次タスクのスキップ設定/解除 |

### 自動削除仕様

| 項目 | 内容 |
|------|------|
| トリガー | アラーム発火時に `alarmTriggeredAt` を記録 |
| 計算起点 | `alarmTriggeredAt` のEpoch秒 |
| 削除タイミング | 起点から **86,400秒（24時間）** 経過後 |
| 対象 | `ONE_TIME` タスクのみ |
| 週ループ | **削除対象外**（`shouldBeDeleted()` は常に `false`） |
| 判定メソッド | `Task.shouldBeDeleted(now, timeZone)` |

### タスクの表示条件

`Task.isActiveOn(date)` で判定：

| タスク種類 | 表示条件 |
|-----------|---------|
| `ONE_TIME` | `createdAt.date == date` かつ未完了・非スキップ |
| `WEEKLY_LOOP` | `weekDays.contains(date.dayOfWeek)` かつ未完了・非スキップ |

---

## 2. 履歴・タイムライン

完了したタスクの履歴を可視化する機能。

### 基本仕様

| 項目 | 内容 |
|------|------|
| 表示形式 | **線形グラフ（タイムライン）** |
| 確認できること | 1日で何をしたかが一目でわかる |
| 保持期間 | **無期限** |

### 履歴ステータス

| ステータス | 説明 | 記録タイミング |
|-----------|------|---------------|
| `COMPLETED` | ユーザーが完了マークを付けた | 完了ボタンタップ時 |
| `SKIPPED` | スキップされた | スキップ実行時 |
| `EXPIRED` | 24時間経過で自動削除 | 自動削除処理時 |

### 履歴データ構造

```kotlin
data class History(
    val id: HistoryId,
    val taskId: TaskId,
    val title: String,
    val completedAt: LocalDateTime,
    val status: HistoryStatus = HistoryStatus.COMPLETED
)
```

### 履歴操作

| 操作 | UseCase | 説明 |
|------|---------|------|
| 追加 | `AddHistoryUseCase` | 履歴エントリを追加 |
| 閲覧 | `GetHistoryTimelineUseCase` | 日付指定でタイムライン取得 |
| 削除 | `DeleteHistoryUseCase` | 個別履歴削除 |
| 全削除 | `ClearAllHistoryUseCase` | 全履歴クリア |
| エクスポート | `ExportHistoryUseCase` | CSV/JSON形式で出力 |

---

## 3. 通知設定

### 通知方法

ユーザーが設定画面で選択可能：

| 通知方法 | 説明 | 対応プラットフォーム |
|---------|------|-------------------|
| 🔔 プッシュ通知 | システム通知として表示 | 全て |
| 🔊 音 | アラーム音を再生 | 全て |
| 📳 バイブレーション | 振動で通知 | モバイルのみ |

### 通知の詳細

| 項目 | 内容 |
|------|------|
| バックグラウンド通知 | ✅ 対応 |
| デバイス再起動後 | ✅ アラーム復元する |
| スヌーズ機能 | ❌ なし（延長機能あり） |
| 通知音 | ✅ カスタム音源対応 |
| 延長機能 | ✅ 通知から「10分延長」が可能 |

### カスタム通知音

| 項目 | 内容 |
|------|------|
| 設定場所 | 設定画面 > カスタム通知音 |
| 対応形式 | 各プラットフォームのサポート形式 |
| データ構造 | `UserSettings.customSoundUri: String?` |
| デフォルト | `null`（システムデフォルト音源） |

---

## 4. 日付ナビゲーション（ホーム画面）

ホーム画面で日別タスクを確認できる機能。

### 基本仕様

| 項目 | 内容 |
|------|------|
| デフォルト表示 | 今日のタスク |
| 日付切り替え | 左右スワイプで前日/翌日へ移動 |
| 表示範囲 | 制限なし（過去・未来どちらも可） |

### UI仕様

| 項目 | 内容 |
|------|------|
| 日付表示 | ヘッダーに「12月25日（水）」形式 |
| 今日に戻る | ヘッダーの日付をタップ |
| スワイプ | HorizontalPager で実装 |

---

## 5. 設定

### 設定項目

| 項目 | 型 | デフォルト値 | 範囲/選択肢 |
|------|-----|------------|------------|
| デフォルトn分前 | `Int` | 10 | 0〜60 |
| 通知音 | `Boolean` | true | ON/OFF |
| バイブレーション | `Boolean` | true | ON/OFF |
| カスタム通知音 | `String?` | null | URI or null |
| テーマ | `ThemeMode` | SYSTEM | LIGHT/DARK/SYSTEM |

### データリセット

| 項目 | 内容 |
|------|------|
| 対象 | 全タスク、全履歴、全アラーム |
| 設定 | 維持される |
| 確認 | ダイアログで確認必須 |
| UseCase | `ResetAllDataUseCase` |

---

## ロードマップ

### Phase 1（完了）
- [x] タスクCRUD
- [x] 履歴表示・エクスポート
- [x] タスク管理画面（週次・登録タスク一覧）
- [x] 日付スワイプナビゲーション（HorizontalPager）
- [x] アラーム通知（Android）
- [x] スキップ機能
- [x] 「今日に戻る」機能
- [x] データリセット機能
- [x] カスタム通知音
- [x] Desktop アラーム実装 (Basic)

### Phase 2（将来）
- [ ] カレンダービュー（月間表示、タスク件数バッジ）
- [ ] ウィジェット対応
- [ ] オンボーディング
- [ ] iOS アラーム実装

---

*作成日: 2025-12-20*
*更新日: 2025-12-27*
